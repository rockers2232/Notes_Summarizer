app.py

import os
import sqlite3
import pytesseract
import pdfplumber
from flask import Flask, render_template, request, jsonify
from werkzeug.utils import secure_filename
from PIL import Image
from huggingface_hub import InferenceClient

app = Flask(__name__)
app.config['UPLOAD_FOLDER'] = 'uploads'
app.config['MAX_CONTENT_LENGTH'] = 16 * 1024 * 1024
os.makedirs(app.config['UPLOAD_FOLDER'], exist_ok=True)

# ---------------------------------------------------------
# CONFIGURATION
# ---------------------------------------------------------
# PASTE YOUR TOKEN HERE
HF_TOKEN = "hf_token" 

# Qwen 2.5 (Smartest free model)
REPO_ID = "Qwen/Qwen2.5-72B-Instruct"

client = InferenceClient(token=HF_TOKEN)
# ---------------------------------------------------------

def init_db():
    conn = sqlite3.connect('database.db')
    c = conn.cursor()
    c.execute('''CREATE TABLE IF NOT EXISTS notes 
                 (id INTEGER PRIMARY KEY, filename TEXT, original_text TEXT, summary TEXT, quiz TEXT)''')
    conn.commit()
    conn.close()

init_db()

def extract_text(filepath):
    ext = filepath.rsplit('.', 1)[1].lower()
    text = ""
    try:
        if ext in ['png', 'jpg', 'jpeg']:
            text = pytesseract.image_to_string(Image.open(filepath))
        elif ext == 'pdf':
            with pdfplumber.open(filepath) as pdf:
                for page in pdf.pages:
                    extract = page.extract_text()
                    if extract:
                        text += extract + "\n"
        elif ext == 'txt':
            with open(filepath, 'r') as f:
                text = f.read()
    except Exception as e:
        print(f"OCR Error: {e}")
        return ""
    return text

def generate_ai_content(text):
    if not text.strip():
        return "No text could be extracted from this file."
    
    # SYSTEM PROMPT: Strict control over spacing and format
    system_instruction = """
    You are a study assistant. 
    Output PURE HTML only. Do not use Markdown. 
    DO NOT leave empty lines at the start.
    
    1. **Summary**: 
       - Start immediately with <h3>Summary</h3>
       - Use <ul> and <li> for points.
    
    2. **Quiz**:
       - Use <h3>Self-Check Quiz</h3>
       - Format questions like this (compact):
         <p>
         <strong>Q1: Question text?</strong><br>
         A) Option<br>
         B) Option<br>
         C) Option<br>
         D) Option<br>
         <strong>Answer: Option X</strong>
         </p>
         
    """

    messages = [
        {"role": "system", "content": system_instruction},
        {"role": "user", "content": f"Here is the text to summarize:\n{text[:4000]}"}
    ]

    print(f"Sending request to {REPO_ID}...") 

    try:
        response = client.chat_completion(
            messages=messages, 
            model=REPO_ID, 
            max_tokens=1500,
            temperature=0.5
        )
        
        ai_reply = response.choices[0].message.content
        
        # --- THE FIX FOR THE GAP ---
        # 1. Remove markdown code blocks if they exist
        clean_reply = ai_reply.replace("```html", "").replace("```", "")
        
        # 2. .strip() removes ALL whitespace/newlines from the very start and end
        clean_reply = clean_reply.strip()
        
        return clean_reply

    except Exception as e:
        error_msg = str(e)
        if "loading" in error_msg.lower():
             return f"⚠️ <b>Model is warming up!</b><br>Please wait 30 seconds and try again."
        if "input_length" in error_msg.lower():
            return "⚠️ <b>File too long!</b><br>Please upload a shorter document."
        print(f"AI Error: {e}") 
        return f"AI Service Error: {e}"

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/upload', methods=['POST'])
def upload_file():
    if 'file' not in request.files:
        return jsonify({'error': 'No file part'})
    
    file = request.files['file']
    if file.filename == '':
        return jsonify({'error': 'No selected file'})

    filename = secure_filename(file.filename)
    filepath = os.path.join(app.config['UPLOAD_FOLDER'], filename)
    file.save(filepath)

    extracted_text = extract_text(filepath)
    ai_result = generate_ai_content(extracted_text)

    conn = sqlite3.connect('database.db')
    c = conn.cursor()
    c.execute("INSERT INTO notes (filename, original_text, summary, quiz) VALUES (?, ?, ?, ?)",
              (filename, extracted_text, ai_result, "Included"))
    conn.commit()
    conn.close()

    return jsonify({
        'filename': filename,
        'text': extracted_text, 
        'result': ai_result
    })

if __name__ == '__main__':
    app.run(debug=True)


    html

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Notes Summarizer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <div class="logo">
                <i class="fas fa-brain"></i> StudyAI
            </div>
            <nav>
                <ul>
                    <li class="active"><i class="fas fa-home"></i> Dashboard</li>
                    <li><i class="fas fa-history"></i> History</li>
                    <li><i class="fas fa-cog"></i> Settings</li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <header>
                <h1>Real-Time Notes Summarizer</h1>
                <p>Upload your notes (PDF, Image, Text) for instant revision.</p>
            </header>

            <section class="upload-section">
                <div class="drop-zone" id="drop-zone">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Drag & Drop files here or <span>Browse</span></p>
                    <input type="file" id="file-input" hidden>
                </div>
            </section>

            <section class="results-section" id="results-area" style="display: none;">
                <div class="card original">
                    <h3><i class="fas fa-file-alt"></i> Extracted Text</h3>
                    <div class="content" id="extracted-text"></div>
                </div>
                
                <div class="card summary">
                    <h3><i class="fas fa-magic"></i> AI Summary & Quiz</h3>
                    <div class="content" id="ai-result"></div>
                </div>
            </section>
        </main>
    </div>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>


style

:root {
    --primary: #4A90E2;
    --bg: #F5F7FA;
    --card-bg: #FFFFFF;
    --text: #333333;
}

body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: var(--bg);
    color: var(--text);
}

.container {
    display: flex;
    height: 100vh;
}

.sidebar {
    width: 250px;
    background-color: white;
    padding: 20px;
    box-shadow: 2px 0 5px rgba(0,0,0,0.05);
}

.sidebar .logo {
    font-size: 24px;
    font-weight: bold;
    color: var(--primary);
    margin-bottom: 40px;
}

.sidebar ul {
    list-style: none;
    padding: 0;
}

.sidebar li {
    padding: 15px 10px;
    cursor: pointer;
    border-radius: 8px;
    color: #666;
    transition: 0.3s;
}

.sidebar li.active, .sidebar li:hover {
    background-color: #E3F2FD;
    color: var(--primary);
}

.main-content {
    flex: 1;
    padding: 40px;
    overflow-y: auto;
}

.upload-section {
    margin-top: 30px;
    background: white;
    padding: 40px;
    border-radius: 12px;
    text-align: center;
    border: 2px dashed #CBD5E0;
    transition: 0.3s;
    cursor: pointer;
}

.upload-section:hover {
    border-color: var(--primary);
    background-color: #FAFBFC;
}

.drop-zone i {
    font-size: 40px;
    color: var(--primary);
    margin-bottom: 10px;
}

.results-section {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 30px;
}

.card {
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
}

.card h3 {
    margin-top: 0;
    color: var(--primary);
    border-bottom: 1px solid #eee;
    padding-bottom: 10px;
}

.content {
    white-space: pre-wrap;
    line-height: 1.6;
    color: #555;
    font-size: 14px;
    
    /* NEW: Adds a scrollbar if text is too long */
    max-height: 400px; 
    overflow-y: auto;  
    background: #f8f9fa; /* Light grey background for contrast */
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #eee;
}


js

const dropZone = document.getElementById('drop-zone');
const fileInput = document.getElementById('file-input');
const resultsArea = document.getElementById('results-area');
const extractedTextDiv = document.getElementById('extracted-text');
const aiResultDiv = document.getElementById('ai-result');

dropZone.addEventListener('click', () => fileInput.click());

fileInput.addEventListener('change', handleUpload);

dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropZone.style.borderColor = '#4A90E2';
});

dropZone.addEventListener('dragleave', () => {
    dropZone.style.borderColor = '#CBD5E0';
});

dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropZone.style.borderColor = '#CBD5E0';
    const files = e.dataTransfer.files;
    if (files.length) {
        fileInput.files = files;
        handleUpload();
    }
});

function handleUpload() {
    const file = fileInput.files[0];
    if (!file) return;

    const formData = new FormData();
    formData.append('file', file);

    // Show loading state
    resultsArea.style.display = 'grid';
    extractedTextDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing OCR...';
    aiResultDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating Summary...';

    fetch('/upload', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            alert(data.error);
            return;
        }
        // Keep this as textContent to avoid XSS from the PDF text itself
        extractedTextDiv.textContent = data.text; 
        
        // --- THE FIX IS HERE ---
        // We use innerHTML so the <b> and <br> tags actually work!
        aiResultDiv.innerHTML = data.result; 
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred during upload.');
    });
}